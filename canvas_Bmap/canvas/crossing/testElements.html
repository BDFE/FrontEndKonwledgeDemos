<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>元素</title>
    <script type="text/javascript" src="./elements.js"></script>
    <script type="text/javascript" src="./draw.js"></script>

</head>

<body>
    <div id="canvas-warp">
        <canvas id="canvas" style="border: 1px solid #aaaaaa; display: block; margin: 50px auto;">
            你的浏览器居然不支持Canvas？！赶快换一个吧！！
        </canvas>
    </div>
    <script>
        let n = 0;
        let canvasWidth = 800;
        let canvasHeight = 800;
        let context = init("canvas", canvasWidth, canvasHeight)
        let roadColor = '#333'

        function getImage(url) {
            return new Promise((resolve, reject) => {
                let image = new Image(); // Create a new blank image.
                image.crossOrigin = "";
                image.src = url;
                if (image.complete) {
                    resolve(image);
                } else {
                    image.onload = function () {
                        resolve(image);
                    }
                }
            })
        }
        let imagePair = {};
        let keys = {
            0: 'turnLeft',
            1: 'straight',
            2: 'turnRight',
        }
        let ps = Object.keys(keys).map(k => {
            let loc = `./${keys[k]}.png`;
            return getImage(loc);
        })


        Promise.all(ps).then(values => {
            values.map((img, index) => {
                imagePair[keys[index]] = img;
            })

            drawElements();
        })

        function drawElements() {
            let eles = [];
            eles.push({
                type: 'ImageIcon',
                // src: _lanes[i].icon,
                image: imagePair['turnLeft'],
                x: 50,
                y: 50,
                width: 40,
                height: 50,
                color: 'red',
            })
            eles.push({
                type: 'Text',
                text: '19',
                x: 70,
                y: 20,
                options: {
                    color: 'red',
                    angle: Math.PI / 2,
                    font: `${~~(20)}px sans-serif`,
                    // textAlign: 'left',
                    // isChinese: false,
                }
            });
            eles.push({
                type: 'Line',
                x: 150,
                y: 0,
                toX: 150,
                toY: 150,
                lineWidth: 2,
                color: 'yellow',
                options: {
                    dashed: false
                }
            })
            eles.push({
                type: 'Line',
                x: 180,
                y: 0,
                toX: 180,
                toY: 150,
                lineWidth: 1,
                color: 'black',
                options: {
                    dashed: true
                }
            })
            eles.push({
                type: 'Dot',
                x: 250,
                y: 80,
                radius: 50,
                color: '#333'
            });
            addElements(eles, (_list) => {
                for (let e of _list) {
                    e.draw(context);
                }
            })
        }
    </script>
</body>

</html>