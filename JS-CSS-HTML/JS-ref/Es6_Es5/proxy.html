<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>

<body>
    <script>
        var target = {};
        var handler = {
            get: function (receiver, name) {
                return `Hello, ${name}!`;
            }
        };
        //    可监听的操作：
        //    get、set、has、deleteProperty、apply、construct、getOwnPropertyDescriptor、defineProperty、
        //    getPrototypeOf、setPrototypeOf、enumerate、ownKeys、preventExtensions、isExtensible。
        var p = new Proxy(target, handler);
        p.world === 'Hello, world!';

        // var obj = new Proxy({}, {
        //     get: function (target, key, receiver) {
        //         console.log(`getting ${key}!`);
        //         return Reflect.get(target, key, receiver);
        //     },
        //     set: function (target, key, value, receiver) {
        //         console.log(`setting ${key}=${value}`);
        //         return Reflect.set(target, key, value, receiver);
        //     }
        // });
        // obj.count = 1;
        // console.log("proxy ++ ")
        //     ++obj.count
    </script>

    <script>
        // Define a validator that takes custom validators and returns a proxy function
        function createValidator(target, validator) {
            return new Proxy(target, {
                _validator: validator,
                set(target, key, value, proxy) {
                    if (target.hasOwnProperty(key)) {
                        let validator = this._validator[key];
                        if (!!validator(value)) {
                            console.log(`set ${key} to ${value}.`)
                            return Reflect.set(target, key, value);
                        } else {
                            throw Error(`Cannot set ${key} to ${value}. Invalid.`);
                        }
                    }
                }
            });
        } // Now, just define validators for each property
        const personValidators = {
            name(val) {
                return typeof val === 'string';
            },
            age(age) {
                return typeof age === 'number' && age > 18;
            }
        }

        class Person {
            constructor(name, age) {
                this.name = name;
                this.age = age;
                return createValidator(this, personValidators);
            }
        }
        const bill = new Person('Bill', 25);

        bill.name = "daniel";
        bill.age = 24;
        console.log(`bill's name:${bill.name},bill's age:${bill.age}`)
        //    bill.age = "12";
        // all of these throw an error
        //    bill.name = 0;
        //    bill.age = 'Bill';
        //    bill.age = 15;
    </script>
</body>

</html>