<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>EventEmitter</title>
</head>

<body>
    <script>
        class EventEmitter {
            constructor() {
                this.events = {};
            }
            on(key, cb) {
                let eventKey = symbol.for(key);
                if (this.events[eventKey]) {
                    let ons = this.events[eventKey] && this.events[eventKey].callbacks;
                    ons.push(cb);
                } else {
                    this.events[eventKey] = {
                        callbacks: [cb]
                    }
                }
            }
            emit(key, ...args) {
                let eventKey = symbol.for(key);
                let ons = this.events[eventKey] && this.events[eventKey].callbacks;
                if (ons && ons.length) {
                    for (let i = 0; i < ons.length; i++) {
                        let on = ons[i];
                        on.apply(this, ...ars);
                    }
                }
            }
        }

        

        Function.prototype.bind = function (context) {
            const self = this;
            let that = arguments[0];
            let args = Array.prototype.slice.call(arguments, 1);
            console.log('bind', context, args);
            return function () {
                let as = Array.prototype.slice.call(arguments, 0);
                console.log('return', args, as);
                return self.apply(that, [].concat(args, as));
            }
        }

        function test(a, b, c) {
            console.log("x=" + this.x, "a=" + a, "b=" + b, "c=" + c);
        }
        var o = {
            x: 1
        }
        test.bind(o, 10)(20, 30); //x=1 a=1 b=2 c=3
    </script>
</body>

</html>